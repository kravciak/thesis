\chapter{Technológie}
\section{Esper}
	Esper je komponenta, ktorá umožňuje spracovanie komplexných udalostí \ac{CEP}. Umožňuje vývoj aplikácií spracovávajúcich veľké množstvo udalostí - v reálnom čase ako aj historických. Tieto udalosti je možné filtrovať a analyzovať podľa potreby a reagovať v reálnom čase na predom definované stavy.  Esper je dostupný v troch verziách:
	\begin{description}
		\item[Esper] je dostupné ako open source s možnosťou komerčnej podpory. Táto verzia obsahuje základ potrebný pre použitie esperu, užívateľ však musí jednotlivé statementy, schémy a nastavenia realizovať programovo. Je preto náročný na použitie pre ľudí, ktorí nevedia programovať. Riešenie je vhodné pre firmy, ktoré buď nevyužijú platenú verziu alebo majú špecifické požiadavky na výsledný produkt a sú schopné túto verziu podľa svojich potrieb upraviť.
		
		\item[Esper HA] je riešenie umožňujúce vysokú dostupnosť Esperu. Zabezpečuje že stav je po vypnutí alebo havárii obnoviteľný. Statementy, schémy a iné nastavenia si EsperHA pri reštarte uchováva, čo je výhoda oproti predchádzajúcej verzii - kde je nutné tieto úkony riešiť programovo. Táto verzia je vhodná pre projekty závislé na vysokej dostupnosti esperu a subjekty, pre ktoré je kritická neustála kontrola prichádzajúcich udalostí.
		EsperHA je spoplatnený, dostupná je trial len verzia, pre ktorej použitie je nutné identifikovať sa ako spoločnosť. Cena nie je na webových stránkach dostupná.
		
		\item[Esper Enterprise Edition] je kompletný produkt "na kľúč", obsahujúci všetky komponenty potrebné pre nasadenie do podniku. V jednom balíku je obsiahnuté GUI pre správu esperu, restové služby poskytujúce prístup zvonku, \ac{EPL} editor, zobrazovacie nástroje umožňujúce kontinuálne zobrazenie výsledkov v grafoch a tabuľkách. EsperEE je možné skombinovať s EsperEA pre dodatočné zabezpečenie vysokej dostupnosti. EsperEE je spoplatnený, rovnako ako pri EsperEA je dostupná trial verzia po splnení určitých podmienok. Cena nie je dostupná, tieto dve dve riešenia sú určené predovšetkým pre podnikový sektor.
	\end{description}
	
	Pre tento projekt je použitá verzia Esper, ktorú som rozšíril o prístup k základným funkciám pomocou restovej api a persistenciu niektorých nastavení a nájdených výsledkov. Táto verzia je dostupná pod GNU General Public License (GPL) (GPL v2).

	\subsection{Procesný model}

	\subsection{Typ udalosti}
	Každá udalosť spracovávaná esperom je definovaná schémou, takzvaným typom udalosti. Tie môžu byť definované pri štarte aplikácie, alebo programovo počas behu. EPL tiež obsahuje klauzulu CREATE SCHEMA umožňujúcu definovanie typu udalosti pomocou EPL. Prehľad základných typov udalostí je v nasledujúcej tabuľke.

	\myTable{
	\begin{tabular}{ | l | p{10cm} | }
		\hline
		Trieda	&	Popis	\\ \hline
		java.lang.Object	&	Akýkoľvek Java POJO (plain-old java object) s getter metódami. Takáto definícia je najjednoduchšia na úkor možnosti úprav počas behu programu.	\\ \hline
		java.util.Map	&	Udalosti definované ako implementácia java.util.Map interface, kde každá hodnota záznamu je vlastnosť udalosti.	\\ \hline
		Object[] (pole objektov)	&	Udalosti definované objektovým poľom, kde každá hodnota poľa je vlastnosť udalosti.	\\ \hline
		org.w3c.dom.Node	&	XML objektový model dokumentu popisujúci štruktúru udalosti.	\\ \hline
	\end{tabular}
	}{Základné typy udalostí}{table:event-types}
	
	Definície typu udalosti sú rozšíriteľné zásuvnými modulmi. Aplikácia môže používať kombináciu týchto typov, nemusí všetky typy definovať jedným spôsobom. Definície typov udalostí je možné reťaziť, kedy typom udalosti môže byť iná komplexná udalosť.
	
	Z dôvodu nutnosti pridávania a mazania udalostí počas behu programu nemôže byť v mojej implementácii použitá definícia typu pomocou POJO. A pretože klient musí mať možnosť definovať typ, bola zvolená definícia pomocou XML schémy. Jednoduchý príklad schémy udalosti znázorňuje nasledujúci výpis. 
	
	\begin{lstlisting}[label=lst:sample-schema,caption=Jednoduchý príklad XML schémy udalosti]
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
	<xs:element name="TweetEvent">
		<xs:complexType>
			<xs:sequence>
				<xs:element name="username" type="xs:string"></xs:element>
				<xs:element name="message" type="xs:string"></xs:element>
			</xs:sequence>
		</xs:complexType>
	</xs:element>
</xs:schema>		
	\end{lstlisting}

	Po definovaní typu udalosti sa na ne môžeme odkazovať klauzulou FROM v EPL statementoch. Tie sú bližšie popísané v nasledujúcej sekcii.

	\subsection{EPL}
		Event Processing Language je jazyk umožňujúci definovanie statementov a patternov v CEP. Syntaxou je podobný SQL. Obsahuje klauzuly SELECT, FROM, WHERE, GROUP BY, HAVING a ORDER BY. Namiesto tabuliek však pracuje so streamami, kde riadok tabuľky nahrádza prichádzajúca udalosť. Streamy udalostí je možné spájať pomocou joinov, filtrovať a agregovať.
		
		Klauzula INSERT INTO je použiteľná na presmerovanie udalostí na iný stream pre dodatočné spracovanie. Klauzula UPDATE slúži na úpravu vlastností udalosti a je aplikovaná pred spracovaním statementu. 
		
		EPL statementy môžu obsahovať definíciu náhľadov (view). Tieto majú viacero funkcií, ako okná náhľadu na stream udalostí, tvorenie štatistík v vlastností udalosti alebo zoskupovanie udalostí. Náhľady môžu byť reťazené. Zabudované náhľady sú napríklad win:length - aplikuje statement na definovaný počet udalostí, win:time - aplikuje statement na udalosti obmedzené časovo alebo std:lastevent - ktorý obsahuje poslednú prijatú udalosť.
		
		EPL definuje koncept pomenovaných okien (named windows), ktoré slúžia ako štruktúra uchovávajúca udalosti. Je možné do nej vkladať nové udalosti a mazať staré. Výhodou tejto štruktúry je možnosť jej použitia viacerými statementami, pretože je globálna, teda zdieľaná v rozsahu daného service providera.	
		
		Pomocou EPL môžeme tiež definovať premenné, ktoré slúžia na vkladanie parametrov do statementu a definovanie schém udalostí. Tými sa zaoberá nasledujúca sekcia.
		
		\subsubsection{Syntax}
		Každý EPL statement musí obsahovať minimálne klauzulu SELECT a FROM.

		SELECT klauzula môže obsahovať náhradný znak * alebo vymenovať požadované vlastnosti udalosti. Tiež definuje typ výslednej udalosti publikovanej statementom. SELECT poskytuje aj nepovinné klauzuly istream (input), irstream (input \& remove) a rstream (remove), ktoré definujú streamy, ktorých udalosti sa majú poslať na UpdateListener a observery statementu. Prednastavené je použitie nastavenia istream.
		
		FROM klauzula špecifikuje jeden alebo viac streamov, pomenovaných okien alebo tabuliek (od verzie esper 5.1). Tie môžu byť pomenované klauzulou AS. Pre join je potrebné definovať viacero streamov. Podporovaný je tiež join so relačnou databázou ako zdrojom dát. To je možné využiť napríklad na prístup k historickým dátam.

		EPL umožňuje definovať pattern, a to ako samostatný výraz alebo ako súčasť statementu. Pattern sa môže vyskytovať kdekoľvek v klauzule FROM, vrátane join. Môžu preto byť použité v kombinácii s klauzulami WHERE, GROUP BY, HAVING a INSERT INTO.
		
		%TODO Patterny

		V nasledujúcich výpisoch sú príklady statementov, zobrazujúcich príklady syntaxe popisovanej v predchádzajúcom texte.
				
		\begin{lstlisting}[label=lst:epl-simple,caption=Jednoduchý EPL statement]
		select * from TweetEvent.win:time(60 sec) where message='happy'
		\end{lstlisting}
		
		\begin{lstlisting}[label=lst:epl-join,caption=Jednoduchý EPL statements použitím join]
		select * from TickEvent.std:unique(symbol) as t, NewsEvent.std:unique(symbol) as n
		where t.symbol = n.symbol
		\end{lstlisting}
		
		\begin{lstlisting}[label=lst:epl-pattern,caption=EPL statement s použitím patternu]
		select a.custId, sum(a.price + b.price)
		from pattern [every a=ServiceOrder -> 
			b=ProductOrder(custId = a.custId) where timer:within(1 min)].win:time(2 hour) 
		where a.name in ('Repair', b.name)
		group by a.custId
		having sum(a.price + b.price) > 100
		\end{lstlisting}
				
		Reprezentácia udalostí formou pojo, xml..
		\subsubsection{Objektový model}	

	\subsection{Api}
		\subsubsection{Konfigurácia}
		EPServiceProvider, epadministrator, epruntime
		
		\subsubsection{Vytváranie statementov}
		\subsubsection{Spracovanie výsledkov}

\section{Cassandra}
	...
	\subsection{Cassandra Query Language}
	\ac{CQL} je jazyk ...
	
\section{Frameworky}
	\subsection{Spring}
	\subsection{RubyOnRails}
	\subsection{Sinatra}
	\subsection{Bootstrap}
